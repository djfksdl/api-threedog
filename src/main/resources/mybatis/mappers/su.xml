<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="su">

	<!-- ************************** user ************************** -->
	<!-- 아이디 중복체크 -->
	<select id="checkId" parameterType="String" resultType="int">
		<![CDATA[
			select count(uId)
			from users
			where uId = #{uId}
		]]>
	</select>

	<!-- 회원가입 -->
	<insert id="insertUser" parameterType="com.javaex.vo.UserVo">
		<![CDATA[
			insert into users
			values(null, #{uId}, #{uPw},#{uName},#{uPhone}, #{uZipCode},#{uAddress},#{uDetailAddress},null,#{uProfile})
		]]>
	</insert>

	<!-- 로그인 -->
	<select id="login" parameterType="com.javaex.vo.UserVo" resultType="com.javaex.vo.UserVo">
		<![CDATA[
			select uNo,
				   uName
			from users
			where uId = #{uId}
			and uPw = #{uPw}
		]]>
	</select>

	<!-- ************************** editPage ************************** -->

	<!-- 가게 등록-business -->
	<update id="updateBusinessInfo" parameterType="com.javaex.vo.BusinessVo">
		<![CDATA[
			UPDATE business 
			SET title = #{title}, subTitle = #{subTitle}, logo = #{logo} 
			WHERE bNo = #{bNo}
		]]>
	</update>

	<!-- 가게 등록-designer -->
	<insert id="insertDesignerInfo" parameterType="com.javaex.vo.BusinessVo">
		<![CDATA[
			insert into designer 
			values(null, #{bNo}, #{dName}, #{introduce},#{dProfile},#{job})
		]]>
	</insert>

	<!-- 가게 등록-price -->
	<insert id="insertPriceInfo" parameterType="java.util.List">
		insert into price(priceNo, beautyNo ,bNo,onePrice) values
		<foreach collection="list" item="price" separator=",">
			(null, #{price.beautyNo}, #{price.bNo}, #{price.onePrice})
		</foreach>
	</insert>

	<!-- 가게 등록-slideImgs -->
	<insert id="insertSlideImgs" parameterType="map">
		insert into homeimg (hiNo, bNo, saveName,orgName,fileSize,filePath,category,cutContents) values
		<foreach collection="slideImgsSaveName" item="slideImgSaveName" separator=",">
			(null, #{bNo}, #{slideImgSaveName},null,null,null,1,null)
		</foreach>
	</insert>

	<!-- 가게 등록-cutImgs -->
	<insert id="insertCutImgs" parameterType="map">
		insert into homeimg (hiNo, bNo, saveName,orgName,fileSize,filePath,category,cutContents) values
		<foreach collection="cutImgsSaveName" item="cutImgsSaveName" separator=",">
			(null, #{bNo}, #{cutImgsSaveName},null,null,null,2,null)
		</foreach>
	</insert>

	<!-- 가게정보 불러오기 -->
	<select id="getShopInfo" parameterType="int" resultType="com.javaex.vo.BusinessVo">
		<![CDATA[
			select b.bNo,
				   bZipCode,
			       bAddress,
			       bdAddress,
			       bPhone,
			       title,
			       subTitle,
			       logo,
			       utilTime,
			       latitude,
			       longitude,
			       dName ,
			       introduce,
			       dProfile ,
			       job,
			       utilTime
			from business b join designer d
			on b.bNo = d.bNo
			where b.bNo=#{bNo}
		]]>
	</select>

	<!-- 가격정보 불러오기 -->
	<select id="getPrice" parameterType="int" resultType="com.javaex.vo.PriceVo">
		<![CDATA[
			SELECT p.bNo,
				   b.beautyNo,
				   sizeDiv,
			       weightDiv,
			       beauty,
			       onePrice
			FROM beautylist b join price p
			on b.beautyNo = p.beautyNo
			where p.bNo=#{bNo}
		]]>
	</select>

	<!-- 메인 슬라이드 이미지 불러오기 -->
	<resultMap id="BusinessVoSlideMap" type="com.javaex.vo.BusinessVo">
		<collection property="slideImgsSaveName" ofType="java.lang.String">
			<result column="saveName" />
		</collection>
	</resultMap>

	<select id="getSlide" parameterType="int" resultMap="BusinessVoSlideMap">
    <![CDATA[
        select saveName,
               category
        from homeimg
        where bNo = #{bNo} and category = 1
    ]]>
	</select>

	<!-- 컷 슬라이드 이미지 불러오기 -->
	<resultMap id="BusinessVoCutMap" type="com.javaex.vo.BusinessVo">
		<collection property="cutImgsSaveName" ofType="java.lang.String">
			<result column="saveName" />
		</collection>
	</resultMap>

	<select id="getCut" parameterType="int" resultMap="BusinessVoCutMap">
    <![CDATA[
        select saveName,
               category
        from homeimg
        where bNo = #{bNo} and category = 2
    ]]>
	</select>


	<!-- 가게 수정 -designer -->
	<update id="updateDesignerInfo" parameterType="com.javaex.vo.BusinessVo">
		<![CDATA[
			update designer 
			set dName =#{dName}, introduce=#{introduce}, dProfile=#{dProfile} , job=#{job}
			where bNo = #{bNo}
		]]>
	</update>

	<!-- 가게 수정-price -->
	<update id="updatePriceInfo" parameterType="java.util.List">
		<foreach collection="list" item="price" separator=";">
			UPDATE price
			SET onePrice = #{price.onePrice}
	        WHERE bNo = #{price.bNo} and beautyNo = #{price.beautyNo}
		</foreach>
	</update>

	<!-- 가게 수정-slideImgs - 삭제-->
	<delete id="deleteSlideImgs" parameterType="map">
		delete from homeimg where bNo=#{bNo} and category=1
	</delete>

	<!-- 가게 등록-cutImgs - 삭제 -->
	<delete id="deleteCutImgs" parameterType="map">
		delete from homeimg where bNo=#{bNo} and category=2
	</delete>





</mapper>