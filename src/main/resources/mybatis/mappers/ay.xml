<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ay">


	<!-- 반려견등록 -->
	<insert id="petInsert" parameterType="com.javaex.vo.DogVo">
      <![CDATA[
	INSERT INTO dog 
		values (
		null,
        #{uNo},
		#{dogName},
		#{kind},
		#{weight},
		#{birth},
		#{gender},
		#{neutering},
		#{experience},
		#{bite},
		#{memo},
		#{dogImg},
		#{size},
		#{skin},
		#{heart},
		#{marking},
		#{mounting}
		)

  ]]>
	</insert>


	<!-- 리뷰 등록 -->
	<insert id="addReview01" parameterType="com.javaex.vo.ReviewVo">
        <![CDATA[
            insert into review
            values (null, #{bNo}, #{uNo}, #{rsNo}, #{star}, #{rContent}, #{rDate}, 0)
        ]]>
		<selectKey keyProperty="rNo" resultType="int" order="AFTER">
            <![CDATA[
                select last_insert_id()
            ]]>
		</selectKey>
	</insert>

	<!-- 리뷰 이미지 등록 -->
	<insert id="addReview02" parameterType="map">
        <![CDATA[
            insert into reviewimg (riNo, rNo, saveName, orgName, filePath)
            values (null, #{rNo}, #{saveName}, #{orgName}, #{filePath})
        ]]>
	</insert>

	<!-- 포인트 추가 -->
	<insert id="insertPoint" parameterType="com.javaex.vo.ReviewVo">
	
        <![CDATA[
        insert into point values (null, #{uNo}, #{rDate}, false, #{rsNo},#{rNo},#{userPoint})
        ]]>
	</insert>

	<!-- 후기가져오기 -->
	<select id="reviewSelect" parameterType="int" resultType="com.javaex.vo.ReviewVo">
		<![CDATA[
		
		]]>
	</select>

	<!--가게정보1개 가져오기 -->
	<select id="selectOne" parameterType="int" resultType="com.javaex.vo.BusinessVo">
		<![CDATA[
		select b.bNo, b.bPhone, b.bAddress, b.bdAddress, b.title ,b.logo, round(avg(r.star),1) averageStar
		from business b 
		join review r on b.bNo=r.bNo
		where b.bNo=#{bNo};
		]]>
	</select>




</mapper>